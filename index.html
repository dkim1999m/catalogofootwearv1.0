<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dmusso Masai</title>
  <style>
    :root{
      --bg:#f3f4f6;
      --panel:#ffffff;
      --card:#ffffff;
      --line:rgba(15,23,42,.12);
      --text:rgba(15,23,42,.92);
      --muted:rgba(15,23,42,.62);
      --accent:#16a34a;
      --accent2:#0ea5e9;
      --radius:18px;
      --shadow: 0 14px 50px rgba(2,6,23,.12);
      --max:1100px;
      --wash:rgba(2,6,23,.03);
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65)), var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    button,input,select{font-family:inherit}

    .container{max-width:var(--max);margin:0 auto;padding:0 16px}

    header{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.76);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px;min-width:220px}
    .logo{width:42px;height:42px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(135deg, rgba(255,255,255,.75), rgba(255,255,255,.35)), linear-gradient(135deg, var(--accent), rgba(2,6,23,.06));border:1px solid rgba(255,255,255,.5);box-shadow:0 10px 30px rgba(2,6,23,.10);color:rgba(2,6,23,.9);font-weight:950;letter-spacing:.6px}
    .title{font-weight:980;letter-spacing:.2px}
    .subtitle{font-size:12px;color:var(--muted)}

    .search{flex:1;min-width:220px;max-width:520px;position:relative}
    .search input{width:100%;padding:12px 44px 12px 14px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.72);color:var(--text);outline:none;font-weight:850;box-shadow:0 10px 40px rgba(2,6,23,.05)}
    .search .icon{position:absolute;right:12px;top:50%;transform:translateY(-50%);opacity:.6}

    .toolbar{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:11px 12px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.72);color:var(--text);font-weight:900;cursor:pointer;box-shadow:0 10px 35px rgba(2,6,23,.05)}
    .btn--primary{background:linear-gradient(135deg, var(--accent), rgba(255,255,255,.65));border-color:rgba(2,6,23,.04);color:rgba(2,6,23,.88)}
    .btn--ghost{background:rgba(255,255,255,.55)}

    main{padding:16px 0 26px}

    .hero{
      margin:14px 0 10px;
      border:1px solid var(--line);
      border-radius:22px;
      overflow:hidden;
      background:
        radial-gradient(700px 240px at 20% 10%, color-mix(in srgb, var(--accent) 26%, transparent), transparent 60%),
        radial-gradient(700px 240px at 90% 0%, color-mix(in srgb, var(--accent2) 22%, transparent), transparent 62%),
        rgba(255,255,255,.78);
      box-shadow:var(--shadow);
    }
    .heroInner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 14px}
    .hero h1{margin:0;font-size:18px;font-weight:990;letter-spacing:.2px}
    .hero p{margin:6px 0 0;color:var(--muted);font-weight:700;font-size:12.5px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:9px 12px;border-radius:999px;border:1px solid rgba(2,6,23,.08);background:rgba(255,255,255,.72);font-weight:950}
    @media (max-width:760px){
      .heroInner{flex-direction:column;align-items:flex-start}
    }

    .filters{display:grid;grid-template-columns:1.2fr .9fr .9fr .9fr auto;gap:10px;align-items:center;margin:12px 0 14px}
    @media (max-width:980px){
      .filters{grid-template-columns:1fr 1fr;}
      .filters .full{grid-column:1/-1}
    }

    select{width:100%;padding:11px 12px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.72);color:var(--text);outline:none;font-weight:850;box-shadow:0 10px 35px rgba(2,6,23,.04)}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:1050px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}

    .card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:
        radial-gradient(320px 220px at 20% 10%, var(--pTint), transparent 62%),
        radial-gradient(260px 220px at 92% 4%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 60%),
        rgba(255,255,255,.86);
      overflow:hidden;
      box-shadow:0 10px 35px rgba(2,6,23,.09);
      transition:transform .15s ease, border-color .15s ease, box-shadow .15s ease;
    }
    .card:hover{border-color:rgba(2,6,23,.16);transform:translateY(-2px);box-shadow:0 18px 50px rgba(2,6,23,.14)}

    .img{height:190px;display:grid;place-items:center;background:linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.15)), var(--wash);border-bottom:1px solid var(--line)}
    .img svg{width:92%;height:92%}

    .body{padding:12px}
    .badges{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .badge{font-size:11px;font-weight:950;letter-spacing:.3px;padding:6px 8px;border-radius:999px;border:1px solid rgba(2,6,23,.10);background:rgba(255,255,255,.68);color:var(--muted)}
    .badge--sale{border-color:color-mix(in srgb, var(--accent2) 45%, rgba(2,6,23,.08));background:color-mix(in srgb, var(--accent2) 12%, rgba(255,255,255,.72));color:rgba(2,6,23,.86)}
    .badge--new{border-color:color-mix(in srgb, var(--accent) 45%, rgba(2,6,23,.08));background:color-mix(in srgb, var(--accent) 12%, rgba(255,255,255,.72));color:rgba(2,6,23,.86)}

    .name{margin:0;font-size:15px;font-weight:980;line-height:1.2}
    .meta{margin-top:6px;color:var(--muted);font-size:12px;display:flex;gap:10px;flex-wrap:wrap}
    .priceRow{display:flex;align-items:baseline;justify-content:space-between;gap:10px;margin-top:10px}
    .price{font-weight:990;font-size:18px}
    .old{font-weight:900;font-size:12px;color:rgba(15,23,42,.48);text-decoration:line-through;margin-left:6px}

    .actions{display:flex;gap:10px;margin-top:10px}
    .actions .btn{flex:1}

    .empty{border:1px solid var(--line);border-radius:18px;background:rgba(255,255,255,.72);padding:14px;color:var(--muted);box-shadow:0 10px 35px rgba(2,6,23,.04)}

    .modal{position:fixed;inset:0;display:none;z-index:50}
    .modal.open{display:block}
    .overlay{position:absolute;inset:0;background:rgba(2,6,23,.50)}
    .panel{position:relative;max-width:980px;margin:4vh auto 0;background:rgba(255,255,255,.92);border:1px solid rgba(2,6,23,.12);border-radius:22px;box-shadow:0 18px 60px rgba(2,6,23,.25);overflow:hidden}
    @media (max-width:1020px){.panel{margin:3vh 14px 0}}

    .close{position:absolute;top:10px;right:10px;border:1px solid rgba(2,6,23,.14);background:rgba(255,255,255,.85);color:rgba(2,6,23,.85);border-radius:12px;padding:8px 10px;cursor:pointer}

    .pdp{display:grid;grid-template-columns:1fr 1fr}
    @media (max-width:860px){.pdp{grid-template-columns:1fr}}

    .left{border-right:1px solid rgba(2,6,23,.12);background:linear-gradient(180deg, rgba(255,255,255,.60), rgba(255,255,255,.35))}
    @media (max-width:860px){.left{border-right:0;border-bottom:1px solid rgba(2,6,23,.12)}}

    .gallery{padding:14px}

    .carousel{position:relative;border:1px solid rgba(2,6,23,.12);border-radius:18px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.18))}
    .track{display:flex;overflow:auto;scroll-snap-type:x mandatory;scroll-behavior:smooth;-webkit-overflow-scrolling:touch}
    .track::-webkit-scrollbar{height:10px}
    .track::-webkit-scrollbar-thumb{background:rgba(2,6,23,.12);border-radius:999px}
    .slide{min-width:100%;scroll-snap-align:center;display:grid;place-items:center}
    .slide svg{width:100%;height:340px}

    .navBtn{position:absolute;top:50%;transform:translateY(-50%);border:1px solid rgba(2,6,23,.14);background:rgba(255,255,255,.88);border-radius:999px;width:40px;height:40px;display:grid;place-items:center;cursor:pointer}
    .navBtn:active{transform:translateY(-50%) scale(.98)}
    .prev{left:10px}
    .next{right:10px}

    .dots{position:absolute;left:0;right:0;bottom:10px;display:flex;justify-content:center;gap:8px}
    .dot{width:8px;height:8px;border-radius:999px;background:rgba(2,6,23,.18);border:1px solid rgba(255,255,255,.7)}
    .dot.active{background:color-mix(in srgb, var(--accent) 70%, rgba(2,6,23,.18))}

    .right{padding:16px}
    .pname{margin:0;font-size:22px;font-weight:990;line-height:1.15}
    .sub{margin-top:8px;color:var(--muted);font-size:13px;display:flex;gap:10px;flex-wrap:wrap}
    .hr{height:1px;background:rgba(2,6,23,.12);margin:14px 0}

    .sizes{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .size{border:1px solid rgba(2,6,23,.14);background:rgba(255,255,255,.80);color:rgba(2,6,23,.88);padding:10px 12px;border-radius:12px;font-weight:980;cursor:pointer;min-width:48px;text-align:center;box-shadow:0 10px 30px rgba(2,6,23,.06)}
    .size.active{border-color:color-mix(in srgb, var(--accent) 55%, rgba(2,6,23,.14));background:color-mix(in srgb, var(--accent) 12%, rgba(255,255,255,.86))}

    .yape{border:1px solid rgba(2,6,23,.12);border-radius:18px;background:rgba(255,255,255,.82);padding:12px;display:flex;gap:14px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .yape img{width:210px;height:210px;border-radius:16px;border:1px solid rgba(2,6,23,.12);object-fit:cover;background:rgba(255,255,255,.65)}
    .yape .ph{width:210px;height:210px;border-radius:16px;border:1px dashed rgba(2,6,23,.22);display:grid;place-items:center;text-align:center;color:var(--muted);padding:12px;background:rgba(255,255,255,.55)}

    .fab{position:fixed;right:18px;bottom:18px;z-index:25;padding:12px 14px;border-radius:999px;background:linear-gradient(135deg, var(--accent), rgba(255,255,255,.85));color:rgba(2,6,23,.86);font-weight:990;box-shadow:0 18px 55px color-mix(in srgb, var(--accent) 18%, rgba(2,6,23,.10))}
  </style>
</head>
<body>

<header>
  <div class="container topbar">
    <div class="brand">
      <div class="logo">DM</div>
      <div>
        <div class="title">Dmusso Masai</div>
        <div class="subtitle">Mejor experiencia de encontrar algo bueno</div>
      </div>
    </div>

    <div class="search" role="search">
      <input id="q" type="search" placeholder="Â¿QuÃ© buscas?" autocomplete="off" />
      <span class="icon" aria-hidden="true">ðŸ”Ž</span>
    </div>

    <div class="toolbar">
      <button class="btn btn--ghost" type="button" id="reset">Reset</button>
    </div>
  </div>
</header>

<main class="container">

  <section class="hero" aria-label="Resumen">
    <div class="heroInner">
      <div>
        <h1 id="heroTitle">CatÃ¡logo general</h1>
        <p id="heroSub">Explora modelos por marca, talla y categorÃ­a.</p>
      </div>
      <div class="pill" id="pill">ðŸ§­ General</div>
    </div>
  </section>

  <div class="filters">
    <div class="full">
      <select id="brand">
        <option value="All">Marca: General</option>
        <option value="Caterpillar">Caterpillar</option>
        <option value="Columbia">Columbia</option>
      </select>
    </div>
    <div>
      <select id="cat">
        <option value="All">CategorÃ­a: Todas</option>
        <option value="Boots">Boots</option>
        <option value="Hiking">Hiking</option>
        <option value="Trail">Trail</option>
        <option value="Urban">Urban</option>
        <option value="Sandals">Sandals</option>
      </select>
    </div>
    <div>
      <select id="size">
        <option value="All">Talla: Todas</option>
        <option value="39">39</option>
        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
      </select>
    </div>
    <div>
      <select id="sort">
        <option value="relevance">Ordenar: Relevancia</option>
        <option value="priceAsc">Precio: Menor a mayor</option>
        <option value="priceDesc">Precio: Mayor a menor</option>
        <option value="newest">Novedades primero</option>
        <option value="discount">Mayor descuento</option>
      </select>
    </div>
    <div>
      <button class="btn btn--primary" type="button" id="apply">Aplicar</button>
    </div>
  </div>

  <div class="grid" id="grid" aria-live="polite"></div>

</main>

<div class="modal" id="modal" aria-hidden="true" role="dialog" aria-label="Detalle de producto">
  <div class="overlay" data-close="1"></div>
  <div class="panel" role="document">
    <button class="close" data-close="1" aria-label="Cerrar">âœ•</button>
    <div id="modalBody"></div>
  </div>
</div>

<a class="fab" id="fab" href="#" target="_blank" rel="noopener">WhatsApp</a>

<script>
  const WHATSAPP = {
    Caterpillar: "51927137867",
    Columbia: "51927137867",
    default: "51927137867"
  };

  const BRAND_THEME = {
    All:   { bg: "#f3f4f6", accent: "#16a34a", accent2: "#0ea5e9", wash: "rgba(2,6,23,.03)", title:"CatÃ¡logo general", pill:"ðŸ§­ General" },
    Caterpillar: { bg: "#fff7d6", accent: "#f4b400", accent2: "#f59e0b", wash: "rgba(245,158,11,.07)", title:"Caterpillar", pill:"ðŸŸ¨ Caterpillar" },
    Columbia: { bg: "#e8f5ff", accent: "#38bdf8", accent2: "#0ea5e9", wash: "rgba(14,165,233,.07)", title:"Columbia", pill:"ðŸŸ¦ Columbia" }
  };

  const YAPE_QR_DATA_URL = "";
  const YAPE_OWNER = "";

  const PRODUCTS = [
    {id:"cat-001",brand:"Caterpillar",sku:"CAT-BOOT-001",name:"Boot TerraShield WP",category:"Boots",price:699,discount:20,isNew:true,rating:4.7,colorHex:"#d4a25b",sizes:[39,40,41,42,43,44,45]},
    {id:"cat-002",brand:"Caterpillar",sku:"CAT-BOOT-002",name:"RuggedForge 6\" Leather",category:"Boots",price:749,discount:0,isNew:false,rating:4.5,colorHex:"#9c6a3a",sizes:[40,41,42,43,44]},
    {id:"cat-003",brand:"Caterpillar",sku:"CAT-HIKE-003",name:"HikeCore Traverse",category:"Hiking",price:639,discount:15,isNew:true,rating:4.6,colorHex:"#6b7d4a",sizes:[39,40,41,42,43,44]},
    {id:"cat-004",brand:"Caterpillar",sku:"CAT-TRAIL-004",name:"TrailBurst GTX Style",category:"Trail",price:579,discount:10,isNew:false,rating:4.3,colorHex:"#7c848c",sizes:[40,41,42,43]},
    {id:"cat-005",brand:"Caterpillar",sku:"CAT-URB-005",name:"UrbanSteel Low",category:"Urban",price:529,discount:0,isNew:true,rating:4.4,colorHex:"#8d7b62",sizes:[39,40,41,42,43]},
    {id:"cat-006",brand:"Caterpillar",sku:"CAT-BOOT-006",name:"IronPath 8\" Pro",category:"Boots",price:799,discount:25,isNew:false,rating:4.8,colorHex:"#c98b3b",sizes:[41,42,43,44,45]},
    {id:"cat-007",brand:"Caterpillar",sku:"CAT-HIKE-007",name:"SummitLine Mid",category:"Hiking",price:669,discount:0,isNew:false,rating:4.2,colorHex:"#7c5a3a",sizes:[39,40,41,42,43,44]},
    {id:"cat-008",brand:"Caterpillar",sku:"CAT-TRAIL-008",name:"RapidTread Runner",category:"Trail",price:499,discount:5,isNew:true,rating:4.1,colorHex:"#9aa0a6",sizes:[39,40,41,42,43]},
    {id:"cat-009",brand:"Caterpillar",sku:"CAT-URB-009",name:"ConcreteCraft Sneaker",category:"Urban",price:459,discount:12,isNew:false,rating:4.0,colorHex:"#b09a7a",sizes:[40,41,42,43,44]},
    {id:"cat-010",brand:"Caterpillar",sku:"CAT-SAND-010",name:"VentTrail Sandal",category:"Sandals",price:329,discount:0,isNew:true,rating:4.3,colorHex:"#6b7280",sizes:[39,40,41,42,43,44]},

    {id:"col-001",brand:"Columbia",sku:"COL-HIKE-001",name:"PeakVista Waterproof",category:"Hiking",price:589,discount:18,isNew:true,rating:4.6,colorHex:"#8ab4f8",sizes:[39,40,41,42,43,44]},
    {id:"col-002",brand:"Columbia",sku:"COL-TRAIL-002",name:"TrailNova Grip",category:"Trail",price:519,discount:0,isNew:false,rating:4.4,colorHex:"#94a3b8",sizes:[40,41,42,43]},
    {id:"col-003",brand:"Columbia",sku:"COL-URB-003",name:"CityRidge Sneaker",category:"Urban",price:449,discount:10,isNew:true,rating:4.2,colorHex:"#cbd5e1",sizes:[39,40,41,42,43]},
    {id:"col-004",brand:"Columbia",sku:"COL-BOOT-004",name:"StormHaven Mid",category:"Boots",price:679,discount:22,isNew:false,rating:4.7,colorHex:"#8b5a2b",sizes:[41,42,43,44,45]},
    {id:"col-005",brand:"Columbia",sku:"COL-HIKE-005",name:"AlpineStep Vent",category:"Hiking",price:539,discount:0,isNew:false,rating:4.1,colorHex:"#7a8f58",sizes:[39,40,41,42,43,44]},
    {id:"col-006",brand:"Columbia",sku:"COL-TRAIL-006",name:"TerraFlow Runner",category:"Trail",price:489,discount:8,isNew:true,rating:4.3,colorHex:"#60a5fa",sizes:[39,40,41,42,43]},
    {id:"col-007",brand:"Columbia",sku:"COL-URB-007",name:"MetroPeak Low",category:"Urban",price:469,discount:0,isNew:false,rating:4.0,colorHex:"#9ca3af",sizes:[40,41,42,43,44]},
    {id:"col-008",brand:"Columbia",sku:"COL-BOOT-008",name:"SummitGuard 6\"",category:"Boots",price:699,discount:15,isNew:true,rating:4.5,colorHex:"#a3a3a3",sizes:[41,42,43,44]},
    {id:"col-009",brand:"Columbia",sku:"COL-SAND-009",name:"CoastLine Sandal",category:"Sandals",price:299,discount:0,isNew:true,rating:4.2,colorHex:"#64748b",sizes:[39,40,41,42,43,44]},
    {id:"col-010",brand:"Columbia",sku:"COL-HIKE-010",name:"RidgeWalker Pro",category:"Hiking",price:599,discount:12,isNew:false,rating:4.4,colorHex:"#a78b6d",sizes:[40,41,42,43,44,45]}
  ];

  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));
  const money = (n)=>`S/ ${Number(n).toFixed(2)}`;
  const finalPrice = (p)=> (p.discount>0 ? Math.round((p.price*(1-p.discount/100))*100)/100 : p.price);

  function tintFromHex(hex, alpha){
    const h = (hex||"#94a3b8").replace("#","");
    const r = parseInt(h.slice(0,2),16);
    const g = parseInt(h.slice(2,4),16);
    const b = parseInt(h.slice(4,6),16);
    return `rgba(${r},${g},${b},${alpha})`;
  }

  function svgShoeVariant(brand,name,color,variant){
    const accent = brand === "Caterpillar" ? "#f4b400" : (brand === "Columbia" ? "#38bdf8" : "#16a34a");
    const base = color || "#cbd5e1";
    const a = variant === 1 ? .24 : (variant === 2 ? .18 : .22);
    const shift = variant === 1 ? 18 : (variant === 2 ? -14 : 0);
    return `
    <svg viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="${name}">
      <defs>
        <linearGradient id="g${variant}" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="${accent}" stop-opacity="${a}"/>
          <stop offset="1" stop-color="#000" stop-opacity="0"/>
        </linearGradient>
        <filter id="s${variant}" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="16" stdDeviation="18" flood-color="#000" flood-opacity=".15"/>
        </filter>
      </defs>
      <rect x="0" y="0" width="900" height="520" rx="28" fill="url(#g${variant})"/>
      <text x="40" y="70" fill="rgba(15,23,42,.75)" font-size="34" font-weight="900" letter-spacing="2">${brand}</text>
      <path filter="url(#s${variant})"
        d="M140 318 C200 250, 250 220, 340 220 C420 220, 470 258, 530 268 C590 278, 650 260, 720 260 C760 260, 790 284, 790 318 C790 350, 770 372, 740 382 C680 402, 600 416, 470 416 C360 416, 270 410, 210 392 C160 376, 120 352, 140 318 Z"
        transform="translate(${shift} 0)"
        fill="${base}" stroke="rgba(255,255,255,.65)" stroke-width="6" />
      <path
        d="M170 356 C250 392, 360 400, 470 400 C600 400, 680 388, 740 370 C760 364, 776 354, 786 340 L786 360 C772 386, 748 400, 720 410 C660 432, 590 446, 470 448 C350 448, 260 440, 200 424 C168 414, 138 396, 122 372 L122 350 C132 360, 150 370, 170 356 Z"
        transform="translate(${shift} 0)"
        fill="rgba(15,23,42,.55)" />
      <circle cx="330" cy="290" r="12" fill="rgba(255,255,255,.55)"/>
      <circle cx="370" cy="286" r="12" fill="rgba(255,255,255,.50)"/>
      <circle cx="410" cy="286" r="12" fill="rgba(255,255,255,.46)"/>
      <text x="40" y="480" fill="rgba(15,23,42,.62)" font-size="22" font-weight="800">${name}</text>
    </svg>`;
  }

  function waLink(product, size){
    const phone = WHATSAPP[product.brand] || WHATSAPP.default;
    const lines = [
      "Hola, quiero informaciÃ³n / comprar:",
      `${product.brand} - ${product.name}`,
      `CÃ³digo: ${product.sku}`,
      `Precio: ${money(finalPrice(product))}`
    ];
    if(size) lines.splice(3,0,`Talla: ${size}`);
    const msg = lines.join("
");
    return `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
  }

  const state = { q:"", brand:"All", cat:"All", size:"All", sort:"relevance" };

  function applyTheme(){
    const key = state.brand in BRAND_THEME ? state.brand : "All";
    const t = BRAND_THEME[key];
    document.documentElement.style.setProperty("--bg", t.bg);
    document.documentElement.style.setProperty("--accent", t.accent);
    document.documentElement.style.setProperty("--accent2", t.accent2);
    document.documentElement.style.setProperty("--wash", t.wash);
    $("#heroTitle").textContent = t.title;
    $("#pill").textContent = t.pill;
  }

  function passes(p){
    const q = state.q.trim().toLowerCase();
    const qOk = !q || (p.name.toLowerCase().includes(q) || p.brand.toLowerCase().includes(q) || p.category.toLowerCase().includes(q) || p.sku.toLowerCase().includes(q));
    const bOk = state.brand==="All" || p.brand===state.brand;
    const cOk = state.cat==="All" || p.category===state.cat;
    const sOk = state.size==="All" || (p.sizes||[]).includes(Number(state.size));
    return qOk && bOk && cOk && sOk;
  }

  function sortList(list){
    const arr = [...list];
    if(state.sort==="priceAsc") arr.sort((a,b)=>finalPrice(a)-finalPrice(b));
    if(state.sort==="priceDesc") arr.sort((a,b)=>finalPrice(b)-finalPrice(a));
    if(state.sort==="newest") arr.sort((a,b)=>(b.isNew?1:0)-(a.isNew?1:0));
    if(state.sort==="discount") arr.sort((a,b)=>(b.discount||0)-(a.discount||0));
    return arr;
  }

  function card(p){
    const sale = (p.discount||0)>0;
    const old = sale ? `<span class="old">${money(p.price)}</span>` : "";
    const tint = tintFromHex(p.colorHex, .18);
    return `
      <article class="card" style="--pTint:${tint}" data-open="${p.id}">
        <div class="img">${svgShoeVariant(p.brand,p.name,p.colorHex,0)}</div>
        <div class="body">
          <div class="badges">
            <span class="badge">${p.brand}</span>
            <span class="badge">${p.category}</span>
            ${p.isNew?`<span class="badge badge--new">NEW</span>`:""}
            ${sale?`<span class="badge badge--sale">-${p.discount}%</span>`:""}
          </div>
          <h3 class="name">${p.name}</h3>
          <div class="meta">
            <span>SKU: <b>${p.sku}</b></span>
            <span>â˜… <b>${p.rating.toFixed(1)}</b></span>
          </div>
          <div class="priceRow">
            <div class="price">${money(finalPrice(p))} ${old}</div>
            <div class="meta">Tallas: <b>${(p.sizes||[]).slice(0,4).join(" ")}</b>â€¦</div>
          </div>
          <div class="actions">
            <button class="btn" type="button" data-open="${p.id}">Ver</button>
            <a class="btn btn--primary" href="${waLink(p)}" target="_blank" rel="noopener">WhatsApp</a>
          </div>
        </div>
      </article>`;
  }

  function render(){
    applyTheme();

    const list = sortList(PRODUCTS.filter(passes));
    $("#grid").innerHTML = list.length ? list.map(card).join("") : `<div class="empty"><b>No hay resultados.</b></div>`;

    const phone = WHATSAPP[state.brand] || WHATSAPP.default;
    $("#fab").href = `https://wa.me/${phone}?text=${encodeURIComponent("Hola, quiero informaciÃ³n del catÃ¡logo de calzado.")}`;

    $$('[data-open]').forEach(el=>{
      el.addEventListener('click',(e)=>{
        if(e.target && e.target.tagName==='A') return;
        openModal(el.getAttribute('data-open'));
      });
    });
  }

  function buildCarousel(p){
    const slides = [0,1,2].map(i=>`<div class="slide">${svgShoeVariant(p.brand,p.name,p.colorHex,i)}</div>`).join("");
    const dots = [0,1,2].map(i=>`<span class="dot" data-dot="${i}"></span>`).join("");
    return `
      <div class="carousel" id="car">
        <div class="track" id="track">${slides}</div>
        <button class="navBtn prev" type="button" data-nav="prev" aria-label="Anterior">â€¹</button>
        <button class="navBtn next" type="button" data-nav="next" aria-label="Siguiente">â€º</button>
        <div class="dots" id="dots">${dots}</div>
      </div>`;
  }

  function openModal(id){
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;

    const sale = (p.discount||0)>0;
    const yape = YAPE_QR_DATA_URL
      ? `<img src="${YAPE_QR_DATA_URL}" alt="QR Yape" />`
      : `<div class="ph">QR Yape</div>`;

    $("#modalBody").innerHTML = `
      <div class="pdp">
        <div class="left">
          <div class="gallery">
            ${buildCarousel(p)}
          </div>
        </div>
        <div class="right">
          <div class="badges">
            <span class="badge">${p.brand}</span>
            <span class="badge">${p.category}</span>
            ${p.isNew?`<span class="badge badge--new">NEW</span>`:""}
            ${sale?`<span class="badge badge--sale">-${p.discount}%</span>`:""}
          </div>

          <h3 class="pname">${p.name}</h3>
          <div class="sub">
            <span>SKU: <b>${p.sku}</b></span>
            <span>â˜… <b>${p.rating.toFixed(1)}</b></span>
          </div>

          <div class="hr"></div>

          <div style="display:flex;gap:12px;align-items:baseline;flex-wrap:wrap">
            <div class="price" style="font-size:28px">${money(finalPrice(p))}
              ${sale?`<span class="old" style="font-size:13px">${money(p.price)}</span>`:""}
            </div>
          </div>

          <div class="hr"></div>

          <div class="sub" style="margin-top:0">Talla (opcional)</div>
          <div class="sizes" id="sizes">
            ${(p.sizes||[]).map(s=>`<button class="size" type="button" data-s="${s}">${s}</button>`).join("")}
          </div>

          <div class="hr"></div>

          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <a class="btn btn--primary" id="buy" href="${waLink(p)}" target="_blank" rel="noopener" style="flex:1;min-width:220px">Comprar por WhatsApp</a>
            <button class="btn" type="button" data-close="1">Cerrar</button>
          </div>

          <div class="hr"></div>

          <div class="yape">
            <div>
              <div style="font-weight:950">Yape</div>
              <div class="sub" style="margin-top:6px">${YAPE_OWNER?`Titular: <b>${YAPE_OWNER}</b>`:""}</div>
            </div>
            ${yape}
          </div>
        </div>
      </div>`;

    let chosen = null;
    $$("#sizes .size").forEach(btn=>{
      btn.addEventListener('click',()=>{
        $$("#sizes .size").forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        chosen = btn.dataset.s;
        $("#buy").href = waLink(p, chosen);
      });
    });

    setupCarousel();

    $("#modal").classList.add('open');
    $("#modal").setAttribute('aria-hidden','false');
  }

  function setupCarousel(){
    const track = $("#track");
    const dots = $$("#dots .dot");
    if(!track || !dots.length) return;

    function setActive(i){
      dots.forEach(d=>d.classList.remove('active'));
      const dot = dots[i];
      if(dot) dot.classList.add('active');
    }

    function currentIndex(){
      const w = track.clientWidth || 1;
      return Math.round(track.scrollLeft / w);
    }

    setActive(0);

    track.addEventListener('scroll',()=>{
      setActive(currentIndex());
    }, {passive:true});

    $$("[data-nav]").forEach(btn=>{
      btn.addEventListener('click',()=>{
        const w = track.clientWidth || 1;
        const i = currentIndex();
        const next = btn.dataset.nav === "next" ? Math.min(2, i+1) : Math.max(0, i-1);
        track.scrollTo({left: next * w, behavior: "smooth"});
        setActive(next);
      });
    });

    dots.forEach(d=>{
      d.addEventListener('click',()=>{
        const i = Number(d.dataset.dot||0);
        const w = track.clientWidth || 1;
        track.scrollTo({left: i * w, behavior: "smooth"});
        setActive(i);
      });
    });
  }

  function closeModal(){
    $("#modal").classList.remove('open');
    $("#modal").setAttribute('aria-hidden','true');
  }

  function syncFromUI(){
    state.brand = $("#brand").value;
    state.cat = $("#cat").value;
    state.size = $("#size").value;
    state.sort = $("#sort").value;
    render();
  }

  $("#q").addEventListener('input',(e)=>{state.q=e.target.value;render();});
  $("#apply").addEventListener('click',syncFromUI);
  $("#brand").addEventListener('change',syncFromUI);
  $("#cat").addEventListener('change',syncFromUI);
  $("#size").addEventListener('change',syncFromUI);
  $("#sort").addEventListener('change',syncFromUI);

  $("#reset").addEventListener('click',()=>{
    state.q=""; state.brand="All"; state.cat="All"; state.size="All"; state.sort="relevance";
    $("#q").value="";
    $("#brand").value="All";
    $("#cat").value="All";
    $("#size").value="All";
    $("#sort").value="relevance";
    render();
  });

  $("#modal").addEventListener('click',(e)=>{ if(e.target && e.target.dataset && e.target.dataset.close) closeModal(); });
  document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal(); });

  function runTests(){
    try{
      const sample = PRODUCTS[0];
      const url1 = waLink(sample);
      const url2 = waLink(sample, 41);
      console.assert(url1.startsWith("https://wa.me/"), "waLink: debe iniciar con https://wa.me/");
      console.assert(url2.includes(encodeURIComponent("Talla: 41")), "waLink: debe incluir talla cuando se pasa size");
      console.assert(!url1.includes(encodeURIComponent("Talla:")), "waLink: no debe incluir talla cuando no se selecciona");
    }catch(e){
      console.error(e);
    }
  }

  render();
  runTests();
</script>
</body>
</html>
