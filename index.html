<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CatÃ¡logo Calzado</title>
  <style>
    :root{
      --bg:#0b0f0d;
      --panel:#0f1713;
      --card:#101a15;
      --line:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --accent:#22c55e;
      --accent2:#f59e0b;
      --radius:18px;
      --shadow: 0 14px 50px rgba(0,0,0,.45);
      --max:1100px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    button,input,select{font-family:inherit}

    .container{max-width:var(--max);margin:0 auto;padding:0 16px}

    header{position:sticky;top:0;z-index:20;background:rgba(11,15,13,.86);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:40px;height:40px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(135deg, rgba(34,197,94,.95), rgba(245,158,11,.70));color:#07100b;font-weight:950;letter-spacing:.6px}
    .title{font-weight:950;letter-spacing:.2px}
    .subtitle{font-size:12px;color:var(--muted)}

    .search{flex:1;min-width:220px;max-width:520px;position:relative}
    .search input{width:100%;padding:12px 44px 12px 14px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);outline:none;font-weight:850}
    .search .icon{position:absolute;right:12px;top:50%;transform:translateY(-50%);opacity:.75}

    .toolbar{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:11px 12px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);font-weight:900;cursor:pointer}
    .btn--primary{background:linear-gradient(135deg, rgba(34,197,94,.95), rgba(34,197,94,.65));border-color:transparent;color:#07100b}
    .btn--ghost{background:transparent}

    main{padding:16px 0 26px}

    .filters{display:grid;grid-template-columns:1.2fr .9fr .9fr .9fr auto;gap:10px;align-items:center;margin:12px 0 14px}
    @media (max-width:980px){
      .filters{grid-template-columns:1fr 1fr;}
      .filters .full{grid-column:1/-1}
    }

    select,input[type="number"]{width:100%;padding:11px 12px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);outline:none;font-weight:850}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:1050px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}

    .card{border:1px solid var(--line);border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));overflow:hidden;box-shadow:0 10px 35px rgba(0,0,0,.30)}
    .card:hover{border-color:rgba(255,255,255,.18)}
    .img{height:190px;display:grid;place-items:center;background:radial-gradient(320px 220px at 30% 20%, rgba(34,197,94,.16), transparent 62%),radial-gradient(260px 220px at 85% 10%, rgba(245,158,11,.16), transparent 58%),rgba(0,0,0,.20);border-bottom:1px solid var(--line)}
    .img svg{width:92%;height:92%}

    .body{padding:12px}
    .badges{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .badge{font-size:11px;font-weight:950;letter-spacing:.3px;padding:6px 8px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.03);color:var(--muted)}
    .badge--sale{border-color:rgba(245,158,11,.35);background:rgba(245,158,11,.10);color:rgba(255,255,255,.92)}
    .badge--new{border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.10);color:rgba(255,255,255,.92)}

    .name{margin:0;font-size:15px;font-weight:950;line-height:1.2}
    .meta{margin-top:6px;color:var(--muted);font-size:12px;display:flex;gap:10px;flex-wrap:wrap}
    .priceRow{display:flex;align-items:baseline;justify-content:space-between;gap:10px;margin-top:10px}
    .price{font-weight:980;font-size:18px}
    .old{font-weight:900;font-size:12px;color:rgba(255,255,255,.55);text-decoration:line-through;margin-left:6px}

    .actions{display:flex;gap:10px;margin-top:10px}
    .actions .btn{flex:1}

    .empty{border:1px solid var(--line);border-radius:18px;background:rgba(255,255,255,.03);padding:14px;color:var(--muted)}

    .modal{position:fixed;inset:0;display:none;z-index:50}
    .modal.open{display:block}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.68)}
    .panel{position:relative;max-width:980px;margin:4vh auto 0;background:linear-gradient(180deg, rgba(16,26,21,.98), rgba(8,12,10,.98));border:1px solid var(--line);border-radius:22px;box-shadow:var(--shadow);overflow:hidden}
    @media (max-width:1020px){.panel{margin:3vh 14px 0}}

    .close{position:absolute;top:10px;right:10px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);border-radius:12px;padding:8px 10px;cursor:pointer}

    .pdp{display:grid;grid-template-columns:1fr 1fr}
    @media (max-width:860px){.pdp{grid-template-columns:1fr}}

    .left{border-right:1px solid var(--line);background:rgba(0,0,0,.18)}
    @media (max-width:860px){.left{border-right:0;border-bottom:1px solid var(--line)}}

    .gallery{padding:14px}
    .mainImg{border:1px solid rgba(255,255,255,.12);border-radius:18px;overflow:hidden;background:rgba(0,0,0,.18);display:grid;place-items:center}
    .mainImg svg{width:100%;height:340px}

    .right{padding:16px}
    .pname{margin:0;font-size:22px;font-weight:990;line-height:1.15}
    .sub{margin-top:8px;color:var(--muted);font-size:13px;display:flex;gap:10px;flex-wrap:wrap}
    .hr{height:1px;background:var(--line);margin:14px 0}

    .sizes{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .size{border:1px solid var(--line);background:rgba(255,255,255,.03);color:var(--text);padding:10px 12px;border-radius:12px;font-weight:980;cursor:pointer;min-width:48px;text-align:center}
    .size.active{border-color:rgba(34,197,94,.45);background:rgba(34,197,94,.12)}

    .yape{border:1px solid var(--line);border-radius:18px;background:rgba(255,255,255,.03);padding:12px;display:flex;gap:14px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .yape img{width:210px;height:210px;border-radius:16px;border:1px solid var(--line);object-fit:cover;background:rgba(255,255,255,.02)}
    .yape .ph{width:210px;height:210px;border-radius:16px;border:1px dashed rgba(255,255,255,.22);display:grid;place-items:center;text-align:center;color:var(--muted);padding:12px}

    .fab{position:fixed;right:18px;bottom:18px;z-index:25;padding:12px 14px;border-radius:999px;background:linear-gradient(135deg, rgba(34,197,94,.95), rgba(34,197,94,.65));color:#07100b;font-weight:990;box-shadow:0 18px 55px rgba(34,197,94,.25)}
  </style>
</head>
<body>

<header>
  <div class="container topbar">
    <div class="brand">
      <div class="logo">TOR</div>
      <div>
        <div class="title">CatÃ¡logo de Calzado</div>
        <div class="subtitle">Caterpillar â€¢ Columbia</div>
      </div>
    </div>

    <div class="search" role="search">
      <input id="q" type="search" placeholder="Â¿QuÃ© buscas?" autocomplete="off" />
      <span class="icon" aria-hidden="true">ðŸ”Ž</span>
    </div>

    <div class="toolbar">
      <button class="btn btn--ghost" type="button" id="reset">Reset</button>
    </div>
  </div>
</header>

<main class="container">

  <div class="filters">
    <div class="full">
      <select id="brand">
        <option value="All">Marca: Todas</option>
        <option value="Caterpillar">Caterpillar</option>
        <option value="Columbia">Columbia</option>
      </select>
    </div>
    <div>
      <select id="cat">
        <option value="All">CategorÃ­a: Todas</option>
        <option value="Boots">Boots</option>
        <option value="Hiking">Hiking</option>
        <option value="Trail">Trail</option>
        <option value="Urban">Urban</option>
        <option value="Sandals">Sandals</option>
      </select>
    </div>
    <div>
      <select id="size">
        <option value="All">Talla: Todas</option>
        <option value="39">39</option>
        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
      </select>
    </div>
    <div>
      <select id="sort">
        <option value="relevance">Ordenar: Relevancia</option>
        <option value="priceAsc">Precio: Menor a mayor</option>
        <option value="priceDesc">Precio: Mayor a menor</option>
        <option value="newest">Novedades primero</option>
        <option value="discount">Mayor descuento</option>
      </select>
    </div>
    <div>
      <button class="btn btn--primary" type="button" id="apply">Aplicar</button>
    </div>
  </div>

  <div class="grid" id="grid" aria-live="polite"></div>

</main>

<div class="modal" id="modal" aria-hidden="true" role="dialog" aria-label="Detalle de producto">
  <div class="overlay" data-close="1"></div>
  <div class="panel" role="document">
    <button class="close" data-close="1" aria-label="Cerrar">âœ•</button>
    <div id="modalBody"></div>
  </div>
</div>

<a class="fab" id="fab" href="#" target="_blank" rel="noopener">WhatsApp</a>

<script>
  const WHATSAPP = {
    Caterpillar: "51927137867",
    Columbia: "51927137867",
    default: "51927137867"
  };

  const YAPE_QR_DATA_URL = "";
  const YAPE_OWNER = "";

  const PRODUCTS = [
    {id:"cat-001",brand:"Caterpillar",sku:"CAT-BOOT-001",name:"Boot TerraShield WP",category:"Boots",price:699,discount:20,isNew:true,rating:4.7,colorHex:"#d4a25b",sizes:[39,40,41,42,43,44,45]},
    {id:"cat-002",brand:"Caterpillar",sku:"CAT-BOOT-002",name:"RuggedForge 6\" Leather",category:"Boots",price:749,discount:0,isNew:false,rating:4.5,colorHex:"#9c6a3a",sizes:[40,41,42,43,44]},
    {id:"cat-003",brand:"Caterpillar",sku:"CAT-HIKE-003",name:"HikeCore Traverse",category:"Hiking",price:639,discount:15,isNew:true,rating:4.6,colorHex:"#6b7d4a",sizes:[39,40,41,42,43,44]},
    {id:"cat-004",brand:"Caterpillar",sku:"CAT-TRAIL-004",name:"TrailBurst GTX Style",category:"Trail",price:579,discount:10,isNew:false,rating:4.3,colorHex:"#7c848c",sizes:[40,41,42,43]},
    {id:"cat-005",brand:"Caterpillar",sku:"CAT-URB-005",name:"UrbanSteel Low",category:"Urban",price:529,discount:0,isNew:true,rating:4.4,colorHex:"#8d7b62",sizes:[39,40,41,42,43]},
    {id:"cat-006",brand:"Caterpillar",sku:"CAT-BOOT-006",name:"IronPath 8\" Pro",category:"Boots",price:799,discount:25,isNew:false,rating:4.8,colorHex:"#c98b3b",sizes:[41,42,43,44,45]},
    {id:"cat-007",brand:"Caterpillar",sku:"CAT-HIKE-007",name:"SummitLine Mid",category:"Hiking",price:669,discount:0,isNew:false,rating:4.2,colorHex:"#7c5a3a",sizes:[39,40,41,42,43,44]},
    {id:"cat-008",brand:"Caterpillar",sku:"CAT-TRAIL-008",name:"RapidTread Runner",category:"Trail",price:499,discount:5,isNew:true,rating:4.1,colorHex:"#9aa0a6",sizes:[39,40,41,42,43]},
    {id:"cat-009",brand:"Caterpillar",sku:"CAT-URB-009",name:"ConcreteCraft Sneaker",category:"Urban",price:459,discount:12,isNew:false,rating:4.0,colorHex:"#b09a7a",sizes:[40,41,42,43,44]},
    {id:"cat-010",brand:"Caterpillar",sku:"CAT-SAND-010",name:"VentTrail Sandal",category:"Sandals",price:329,discount:0,isNew:true,rating:4.3,colorHex:"#6b7280",sizes:[39,40,41,42,43,44]},

    {id:"col-001",brand:"Columbia",sku:"COL-HIKE-001",name:"PeakVista Waterproof",category:"Hiking",price:589,discount:18,isNew:true,rating:4.6,colorHex:"#8ab4f8",sizes:[39,40,41,42,43,44]},
    {id:"col-002",brand:"Columbia",sku:"COL-TRAIL-002",name:"TrailNova Grip",category:"Trail",price:519,discount:0,isNew:false,rating:4.4,colorHex:"#94a3b8",sizes:[40,41,42,43]},
    {id:"col-003",brand:"Columbia",sku:"COL-URB-003",name:"CityRidge Sneaker",category:"Urban",price:449,discount:10,isNew:true,rating:4.2,colorHex:"#cbd5e1",sizes:[39,40,41,42,43]},
    {id:"col-004",brand:"Columbia",sku:"COL-BOOT-004",name:"StormHaven Mid",category:"Boots",price:679,discount:22,isNew:false,rating:4.7,colorHex:"#8b5a2b",sizes:[41,42,43,44,45]},
    {id:"col-005",brand:"Columbia",sku:"COL-HIKE-005",name:"AlpineStep Vent",category:"Hiking",price:539,discount:0,isNew:false,rating:4.1,colorHex:"#7a8f58",sizes:[39,40,41,42,43,44]},
    {id:"col-006",brand:"Columbia",sku:"COL-TRAIL-006",name:"TerraFlow Runner",category:"Trail",price:489,discount:8,isNew:true,rating:4.3,colorHex:"#60a5fa",sizes:[39,40,41,42,43]},
    {id:"col-007",brand:"Columbia",sku:"COL-URB-007",name:"MetroPeak Low",category:"Urban",price:469,discount:0,isNew:false,rating:4.0,colorHex:"#9ca3af",sizes:[40,41,42,43,44]},
    {id:"col-008",brand:"Columbia",sku:"COL-BOOT-008",name:"SummitGuard 6\"",category:"Boots",price:699,discount:15,isNew:true,rating:4.5,colorHex:"#a3a3a3",sizes:[41,42,43,44]},
    {id:"col-009",brand:"Columbia",sku:"COL-SAND-009",name:"CoastLine Sandal",category:"Sandals",price:299,discount:0,isNew:true,rating:4.2,colorHex:"#64748b",sizes:[39,40,41,42,43,44]},
    {id:"col-010",brand:"Columbia",sku:"COL-HIKE-010",name:"RidgeWalker Pro",category:"Hiking",price:599,discount:12,isNew:false,rating:4.4,colorHex:"#a78b6d",sizes:[40,41,42,43,44,45]}
  ];

  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));
  const money = (n)=>`S/ ${Number(n).toFixed(2)}`;
  const finalPrice = (p)=> (p.discount>0 ? Math.round((p.price*(1-p.discount/100))*100)/100 : p.price);

  function svgShoe(brand,name,color){
    const accent = brand === "Caterpillar" ? "#f59e0b" : "#22c55e";
    const base = color || "#cbd5e1";
    return `
    <svg viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="${name}">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="${accent}" stop-opacity=".28"/>
          <stop offset="1" stop-color="#000" stop-opacity="0"/>
        </linearGradient>
        <filter id="s" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="16" stdDeviation="18" flood-color="#000" flood-opacity=".35"/>
        </filter>
      </defs>
      <rect x="0" y="0" width="900" height="520" rx="28" fill="url(#g)"/>
      <text x="40" y="70" fill="rgba(255,255,255,.84)" font-size="34" font-weight="900" letter-spacing="2">${brand}</text>
      <path filter="url(#s)"
        d="M140 318 C200 250, 250 220, 340 220 C420 220, 470 258, 530 268 C590 278, 650 260, 720 260 C760 260, 790 284, 790 318 C790 350, 770 372, 740 382 C680 402, 600 416, 470 416 C360 416, 270 410, 210 392 C160 376, 120 352, 140 318 Z"
        fill="${base}" stroke="rgba(255,255,255,.16)" stroke-width="6" />
      <path
        d="M170 356 C250 392, 360 400, 470 400 C600 400, 680 388, 740 370 C760 364, 776 354, 786 340 L786 360 C772 386, 748 400, 720 410 C660 432, 590 446, 470 448 C350 448, 260 440, 200 424 C168 414, 138 396, 122 372 L122 350 C132 360, 150 370, 170 356 Z"
        fill="rgba(15,23,19,.85)" />
      <circle cx="330" cy="290" r="12" fill="rgba(255,255,255,.25)"/>
      <circle cx="370" cy="286" r="12" fill="rgba(255,255,255,.22)"/>
      <circle cx="410" cy="286" r="12" fill="rgba(255,255,255,.20)"/>
      <text x="40" y="480" fill="rgba(255,255,255,.68)" font-size="22" font-weight="800">${name}</text>
    </svg>`;
  }

  function waLink(product, size){
    const phone = WHATSAPP[product.brand] || WHATSAPP.default;
    const lines = [
      "Hola, quiero informaciÃ³n / comprar:",
      `${product.brand} - ${product.name}`,
      `CÃ³digo: ${product.sku}`,
      `Precio: ${money(finalPrice(product))}`
    ];
    if(size) lines.splice(3,0,`Talla: ${size}`);
    const msg = lines.join("\n");
    return `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
  }

  const state = { q:"", brand:"All", cat:"All", size:"All", sort:"relevance" };

  function passes(p){
    const q = state.q.trim().toLowerCase();
    const qOk = !q || (p.name.toLowerCase().includes(q) || p.brand.toLowerCase().includes(q) || p.category.toLowerCase().includes(q) || p.sku.toLowerCase().includes(q));
    const bOk = state.brand==="All" || p.brand===state.brand;
    const cOk = state.cat==="All" || p.category===state.cat;
    const sOk = state.size==="All" || (p.sizes||[]).includes(Number(state.size));
    return qOk && bOk && cOk && sOk;
  }

  function sortList(list){
    const arr = [...list];
    if(state.sort==="priceAsc") arr.sort((a,b)=>finalPrice(a)-finalPrice(b));
    if(state.sort==="priceDesc") arr.sort((a,b)=>finalPrice(b)-finalPrice(a));
    if(state.sort==="newest") arr.sort((a,b)=>(b.isNew?1:0)-(a.isNew?1:0));
    if(state.sort==="discount") arr.sort((a,b)=>(b.discount||0)-(a.discount||0));
    return arr;
  }

  function card(p){
    const sale = (p.discount||0)>0;
    const old = sale ? `<span class="old">${money(p.price)}</span>` : "";
    return `
      <article class="card" data-open="${p.id}">
        <div class="img">${svgShoe(p.brand,p.name,p.colorHex)}</div>
        <div class="body">
          <div class="badges">
            <span class="badge">${p.brand}</span>
            <span class="badge">${p.category}</span>
            ${p.isNew?`<span class="badge badge--new">NEW</span>`:""}
            ${sale?`<span class="badge badge--sale">-${p.discount}%</span>`:""}
          </div>
          <h3 class="name">${p.name}</h3>
          <div class="meta">
            <span>SKU: <b>${p.sku}</b></span>
            <span>â˜… <b>${p.rating.toFixed(1)}</b></span>
          </div>
          <div class="priceRow">
            <div class="price">${money(finalPrice(p))} ${old}</div>
            <div class="meta">Tallas: <b>${(p.sizes||[]).slice(0,4).join(" ")}</b>â€¦</div>
          </div>
          <div class="actions">
            <button class="btn" type="button" data-open="${p.id}">Ver</button>
            <a class="btn btn--primary" href="${waLink(p)}" target="_blank" rel="noopener">WhatsApp</a>
          </div>
        </div>
      </article>`;
  }

  function render(){
    const list = sortList(PRODUCTS.filter(passes));
    $("#grid").innerHTML = list.length ? list.map(card).join("") : `<div class="empty"><b>No hay resultados.</b></div>`;

    const phone = WHATSAPP[state.brand] || WHATSAPP.default;
    $("#fab").href = `https://wa.me/${phone}?text=${encodeURIComponent("Hola, quiero informaciÃ³n del catÃ¡logo de calzado.")}`;

    $$('[data-open]').forEach(el=>{
      el.addEventListener('click',(e)=>{
        if(e.target && e.target.tagName==='A') return;
        openModal(el.getAttribute('data-open'));
      });
    });
  }

  function openModal(id){
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;

    const sale = (p.discount||0)>0;
    const yape = YAPE_QR_DATA_URL
      ? `<img src="${YAPE_QR_DATA_URL}" alt="QR Yape" />`
      : `<div class="ph">QR Yape</div>`;

    $("#modalBody").innerHTML = `
      <div class="pdp">
        <div class="left">
          <div class="gallery">
            <div class="mainImg">${svgShoe(p.brand,p.name,p.colorHex)}</div>
          </div>
        </div>
        <div class="right">
          <div class="badges">
            <span class="badge">${p.brand}</span>
            <span class="badge">${p.category}</span>
            ${p.isNew?`<span class="badge badge--new">NEW</span>`:""}
            ${sale?`<span class="badge badge--sale">-${p.discount}%</span>`:""}
          </div>

          <h3 class="pname">${p.name}</h3>
          <div class="sub">
            <span>SKU: <b>${p.sku}</b></span>
            <span>â˜… <b>${p.rating.toFixed(1)}</b></span>
          </div>

          <div class="hr"></div>

          <div style="display:flex;gap:12px;align-items:baseline;flex-wrap:wrap">
            <div class="price" style="font-size:28px">${money(finalPrice(p))}
              ${sale?`<span class="old" style="font-size:13px">${money(p.price)}</span>`:""}
            </div>
          </div>

          <div class="hr"></div>

          <div class="sub" style="margin-top:0">Talla (opcional)</div>
          <div class="sizes" id="sizes">
            ${(p.sizes||[]).map(s=>`<button class="size" type="button" data-s="${s}">${s}</button>`).join("")}
          </div>

          <div class="hr"></div>

          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <a class="btn btn--primary" id="buy" href="${waLink(p)}" target="_blank" rel="noopener" style="flex:1;min-width:220px">Comprar por WhatsApp</a>
            <button class="btn" type="button" data-close="1">Cerrar</button>
          </div>

          <div class="hr"></div>

          <div class="yape">
            <div>
              <div style="font-weight:950">Yape</div>
              <div class="sub" style="margin-top:6px">${YAPE_OWNER?`Titular: <b>${YAPE_OWNER}</b>`:""}</div>
            </div>
            ${yape}
          </div>
        </div>
      </div>`;

    let chosen = null;
    $$("#sizes .size").forEach(btn=>{
      btn.addEventListener('click',()=>{
        $$("#sizes .size").forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        chosen = btn.dataset.s;
        $("#buy").href = waLink(p, chosen);
      });
    });

    $("#modal").classList.add('open');
    $("#modal").setAttribute('aria-hidden','false');
  }

  function closeModal(){
    $("#modal").classList.remove('open');
    $("#modal").setAttribute('aria-hidden','true');
  }

  function syncFromUI(){
    state.brand = $("#brand").value;
    state.cat = $("#cat").value;
    state.size = $("#size").value;
    state.sort = $("#sort").value;
    render();
  }

  $("#q").addEventListener('input',(e)=>{state.q=e.target.value;render();});
  $("#apply").addEventListener('click',syncFromUI);
  $("#brand").addEventListener('change',syncFromUI);
  $("#cat").addEventListener('change',syncFromUI);
  $("#size").addEventListener('change',syncFromUI);
  $("#sort").addEventListener('change',syncFromUI);

  $("#reset").addEventListener('click',()=>{
    state.q=""; state.brand="All"; state.cat="All"; state.size="All"; state.sort="relevance";
    $("#q").value="";
    $("#brand").value="All";
    $("#cat").value="All";
    $("#size").value="All";
    $("#sort").value="relevance";
    render();
  });

  $("#modal").addEventListener('click',(e)=>{ if(e.target && e.target.dataset && e.target.dataset.close) closeModal(); });
  document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal(); });

  function runTests(){
    try{
      const sample = PRODUCTS[0];
      const url1 = waLink(sample);
      const url2 = waLink(sample, 41);
      console.assert(url1.startsWith("https://wa.me/"), "waLink: debe iniciar con https://wa.me/");
      console.assert(url2.includes(encodeURIComponent("Talla: 41")), "waLink: debe incluir talla cuando se pasa size");
      console.assert(!url1.includes(encodeURIComponent("Talla:")), "waLink: no debe incluir talla cuando no se selecciona");
    }catch(e){
      console.error(e);
    }
  }

  render();
  runTests();
</script>
</body>
</html>
